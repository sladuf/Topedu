<!DOCTYPE html>
<html>
<head>
    <title>
        TOPedu    
    </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="../design/index.css" rel="stylesheet">
    <?
    include '../session.php';
    ?>
</head>
<body>
    <div class='wrap'>    
        <div class='middle'>
            <img src="../design/logo_red_name.png" style="width: 100%;" alt='logo'>
            <h2 style="color: #E6061F;"><? echo $name; ?></h2>
            <select id='list' class ='select_level'>
            </select><br>
            <button class='btn' onclick="search()">검색</button>
        </div>
    </div>
    <script type="text/javascript" src="../level.js"></script>
    <script>
        var list = document.getElementById('list');
            var cont="<option value=''>level</option>";
            for(var i=0; i < level.length; i++){
                cont += "<option value='"+level[i]+"'>"+level[i]+"</option>";
            }
            list.innerHTML=cont;
    </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script>
        var All = [];
        function search() {
            $.ajax({
                url: "search.php",
                type: "get",
                data: {
                    st_level : $('#list').val(),
                }
            }).done(function(data) {
                const result = jQuery.parseJSON(data);
                var res="<p onclick='window.location.reload()'><u>뒤로가기</u></p>";
                for(var i=0; i<result.length; i++){
                    All.push(result[i].id);
                    res += "<input type='checkbox' class='checkbox-label' id='"+i+"' value='"+result[i].id+"'>\
                            <label for='"+i+"'>"+result[i].name+"</label><br>";
                }
                res+="<button class='btn2' onclick='modify()'>수정</button>\
                    <button class='btn2' onclick='del()'>삭제</button></div>";

                $('.middle').html(res);
            });
        }
        function modify(){
            //popup -> {체크한 애들}의 레벨을 변경하시겠습니까? 되돌리기가 불가능 합니다.
            //ok하면 레벨 선택창 띄우기
           
        }
        function del(){

            var chk = $(".checkbox-label");
            var st_id = [];
            for(var i=0; i<chk.length; i++){
                if(chk[i].checked == true){
                   st_id.push(chk[i].value);
                }
            }
            if(st_id.length > 0){
                var bool = confirm("확인버튼을 누르시면 모든 정보가 지워집니다.\n복구할 수 없습니다.");
                if(bool){
                    $.ajax({
                    url: "delete_student.php",
                    type: "get",
                    data: {
                        st_id : st_id,
                    }
                    }).done(function(data) {
                        alert("모든 정보를 지웠습니다.");
                        window.location.reload();
                    });
                }   
            }
            else{
                alert("삭제할 학생을 지정 하세요.");
            }
            
        }
    </script>
    <div class='error'>
        <h2>지원하지 않는 화면 크기입니다.</h2>
    </div>
</body>
</html>